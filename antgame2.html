<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ant1k Attack 🐜</title>
<style>
  /* Minimal reset */
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    cursor: grab;
  }
</style>
</head>
<body>
<script>
'use strict';

// create canvas
const a = document.body.appendChild(document.createElement('canvas'));
const c = a.getContext("2d");
a.width = innerWidth;
a.height = innerHeight;

// constants
const MAX_ANT_COUNT = 100;
const HALF_ANT_COUNT = MAX_ANT_COUNT/2|0;
const QUART_ANT_COUNT = MAX_ANT_COUNT/4|0;

// locals
let i,j,k,l, objects, objectCount, score, totalScore, canvasBack, contextBack;

// helper to set color
let hsl = (s=0,l=0,a1=1)=> contextBack.fillStyle = c.fillStyle = `hsl(0,${s}%,${l}%,${a1})`;

// draw ant
let drawAnt = (p, ctx)=>
{
    for(i=3;i--;){
        hsl(0,0,.2);
        p.v && ctx.beginPath(ctx.fill(ctx.ellipse(
            p.x,p.y+p.r/4,
            p.r*(.5-i/6), p.r*(1.3-i/6),
            p.a,0,9
        )));
        hsl();
        ctx.beginPath(ctx.fill(ctx.ellipse(
            p.x,p.y,
            p.r/.6,p.r/15,
            p.a+Math.sin(i*2+p.d/13),0,9
        )));
    }
    for(i=3;i--;){
        hsl(50,9);
        ctx.beginPath(ctx.fill(ctx.ellipse(
            p.x-p.r*Math.sin(p.a)*(i-1.4),
            p.y+p.r*(Math.cos(p.a)*(i-1.4))-p.r/4,
            p.r*(i-1?.4:.2),
            p.r*(i?.8:.4),
            p.a,0,9
        )));
    }
};

// spawn ant
let spawnObject = ()=>
{
    objects.push({
        x: ++objectCount%2 ? a.width*Math.random() : Math.random() < .5 ? -50 : a.width+50,
        y: objectCount%2 ? Math.random()<.5?-50:a.height+50 : a.height*Math.random(),
        r: objectCount>QUART_ANT_COUNT ? 5+Math.random()*6 : 7+Math.random()*3,
        v: Math.random()+1,
        a: 0,
        d: 0
    });
};

// main update loop
let update = ()=>
{
    a.width += 0; // clear canvas

    objects.map(p=>{
        if(p.v){
            p.x += p.v*Math.sin(p.a += (Math.random()*2-1)*.03);
            p.y -= p.v*Math.cos(p.a += (Math.random()*2-1)*.03);
            p.d += p.v -= p.v>2 && .002;

            if(p.x<-15) p.a = Math.random()*2-1+33;
            if(p.x>a.width+15) p.a = Math.random()*2-1-33;
            if(p.y<-15) p.a = Math.random()*2-1+22;
            if(p.y>a.height+15) p.a = Math.random()*2-1;

            drawAnt(p, c);
        }
    });

    c.font = '6em cursive';
    for(i=9;i--;){
        hsl(99,50-i*9);
        score && c.fillText(totalScore,29+i,99+i);
    }
};

// setup background canvas
a.before(canvasBack = a.cloneNode(a.style.position='absolute'));
contextBack = canvasBack.getContext("2d");

// draw background tiles
for(i=99;i--;)
for(j=99;j--;)
for(l=99-Math.random()*15,k=9;k--;){
    hsl(objectCount=score=totalScore=0,l-k*3);
    contextBack.fillRect(i*99-k/6,j*99-k/6,91+k,91+k);
}

// initialize game
objects=[];
spawnObject();

// mouse click handling
onmousedown = e=>{
    objects.map(p=>{
        if(p.v && Math.hypot(p.x-e.x,p.y-e.y)<p.r*2){
            p.v=0;
            ++totalScore;
            if(++score==MAX_ANT_COUNT) objectCount=score=0;

            for(i=score?score==HALF_ANT_COUNT?MAX_ANT_COUNT:2:1;i--;)
                if(objectCount<HALF_ANT_COUNT||score==HALF_ANT_COUNT&&objectCount<MAX_ANT_COUNT)
                    spawnObject();

            for(i=29;i--;){
                hsl(99,50-Math.random()*20,.3);
                contextBack.beginPath(contextBack.fill(contextBack.ellipse(
                    p.x+p.r*(Math.random()*2-1),
                    p.y+p.r*(Math.random()*2-1),
                    p.r*(Math.random()+1)/2,
                    p.r*(Math.random()+1)/7,
                    Math.random()*9,0,9
                )));
            }
            drawAnt(p, contextBack);
        }
        if(p.v && Math.hypot(p.x-e.x,p.y-e.y)<199){
            p.v=Math.random()*3+2;
            p.a=Math.atan2(p.x-e.x,e.y-p.y)+Math.random()*2-1;
        }
    });
};

// start game loop
setInterval(update,16); // ~60fps

</script>
</body>
</html>
